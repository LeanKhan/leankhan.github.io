---
// Component Imports
import BaseHead from '../../components/BaseHead.astro';
import BaseHeader from '../../components/BaseHeader.astro';
import BlogPostPreview from '../../components/BlogPostPreview.astro';

// Component Script:
// You can write any JavaScript/TypeScript that you'd like here.
// It will run during the build, but never in the browser.
// All variables are available to use in the HTML template below.
let title = 'Posts';
let description = 'All Posts';
let permalink = 'https://e.segunlean.com/posts';

// Data Fetching: List all Markdown posts in the repo.

let allPosts = await Astro.glob('./*.md');
allPosts = allPosts.filter(p => !p.frontmatter.draft).sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());

let pinnedPosts = allPosts.filter(p => p.frontmatter.pinned);

// Full Astro Component Syntax:
// https://docs.astro.build/core-concepts/astro-components/
---

<html lang="en">
	<head>
		<BaseHead {title} {description} {permalink} />

		<style>
			header {
				width: 100%;
				height: 100%;
				background-color: var(--theme-bg-offset);
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.content {
				margin-top: 4rem;
				margin-bottom: 8rem;
			}

			.content :global(main > * + *) {
				margin-top: 1rem;
			}

			.intro {
				padding-bottom: 4rem;
				margin-bottom: 2rem;
				border-bottom: 4px solid var(--theme-divider);
			}

			.intro > * {
				margin: 0;
			}

			.latest {
				font-size: 2.5rem;
				font-weight: 700;
			}

			.pinned-section {
				margin-bottom: 2rem;
				padding-bottom: 2rem;
				border-bottom: 4px solid var(--theme-divider);
			}

			.pinned-list {
				margin: 0;
			}

			.section-title {
				font-size: 0.8rem;
			}
		</style>
	</head>

	<body>
		  <div class="main-wrapper section md-section">
    <BaseHeader />
      <main class="main-content">
	  <section>
					<h3 class="page-title text-light">{title}</h3>
					<!-- <p>{description}</p> -->
				</section>
				{pinnedPosts.length > 0 && (
				<section class="pinned-section" aria-label="Pinned posts">
					<h5 class="section-title text-light">Pinned</h5>
					<p>These are some of my favorite posts</p>
					<p class="pinned-list">
						{pinnedPosts.map((p, i) => (
							<>{i > 0 && ", "}<a href={p.url}>{p.frontmatter.title}</a></>
						))}
					</p>
				</section>
				)}
				<section aria-label="Blog post list">
					{allPosts.map((p) => <BlogPostPreview post={p} />)}
				</section>
			</main>
		</div>


	</body>
</html>
